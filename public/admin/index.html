<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Include the script that builds the page and powers Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <script>
      CMS.registerPreviewStyle("../styles/content.module.css");
      CMS.registerPreviewStyle("https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400&display=swap");

      var PostPreview = createClass({
        render: function () {
          var entry = this.props.entry;
          var date = entry.getIn(["data", "date"]);
          return h(
            "div",
            { className: "content" },
            h("h1", {}, entry.getIn(["data", "title"])),
            h("time", {}, entry.getIn(["data", "date"])),
            h("div", {}, this.props.widgetFor("body"))
          );
        },
      });
      var EventPreview = createClass({
        render: function () {
          var entry = this.props.entry;
          var date = entry.getIn(["data", "date"]);
          return h(
                  "div",
                  { className: "content" },
                  h("h1", {}, entry.getIn(["data", "name"])),
                  h("time", {}, entry.getIn(["data", "location"])),
                  h("div", {}, this.props.widgetFor("body"))
          );
        },
      });
      CMS.registerPreviewTemplate("posts", PostPreview);
      CMS.registerPreviewTemplate("events", EventPreview);

      CMS.registerEditorComponent({
        id: "youtube",
        label: "Youtube video",
        fields: [{name: 'id', label: 'Youtube Video ID'}],
        patter: /^<div class="video-container">\n.*<iframe class="youtube-embed".*embed\/(.*?)".*<\/iframe>\n<\/div>$/ms,
        fromBlock: function(match) {
          return { id: match[1] };
        },
        toBlock: function(obj) { return `
<div class="video-container">
    <iframe class="youtube-embed"
            src="https://www.youtube.com/embed/${obj.id}"
            frameBorder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowFullScreen>
    </iframe>
</div>`; },
        toPreview: function(obj) {
          return (`
<div class="video-container">
    <iframe class="youtube-embed"
            src="https://www.youtube.com/embed/${obj.id}"
            frameBorder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowFullScreen>
    </iframe>
</div>`);
        }
      });

      CMS.registerEditorComponent({
        id: "instagram",
        label: "Instagram post",
        fields: [{name: 'id', label: 'Instagram Post ID'}],
        pattern: /^<iframe class='instagram-post'.*p\/(.*?)\/.*frameBorder='1'>\n<\/iframe>$/ms,
        fromBlock: function(match) {
          return { id: match[1] };
        },
        toBlock: function(obj) { return `
<iframe class='instagram-post'
        src="https://www.instagram.com/p/${obj.id}/embed/captioned/"
        width="100%"
        frameBorder='1'>
</iframe>`; },
        toPreview: function(obj) {
          return (`
<iframe class='instagram-post'
        src="https://www.instagram.com/p/${obj.id}/embed/captioned/"
        width="100%"
        frameBorder='1'>
</iframe>
`);
        }
      });
    </script>
  </body>
</html>
